<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../gold-email-input/gold-email-input.html">

<link rel="import" href="../things-form/things-form-behavior.html">
<link rel="import" href="../things-spinner/things-spinner-behavior.html">
<link rel="import" href="../things-msg-box-behavior/things-msg-box-behavior.html">

<!--
 사용자 비밀번호 초기화 요청 화면 

@demo demo/index.html
-->

<dom-module id="things-password-init">
  <template>
    <style>
      :host {
        @apply(--things-loose-padding)
      }

      paper-button {
        @apply(--things-button);
        float: right;
        margin-top: 15px;
      }

      .btn-submit {
        @apply(--things-button-important)
      }
    </style>

    <things-i18n-msg auto msgid="text.password_inited" msg="{{tPasswordInited}}" hidden>Password Initializing is requested.</things-i18n-msg>
    <things-i18n-msg auto msgid="text.check_password_in_mail" msg="{{tCheckPasswordInMail}}" hidden>You will get an email from admin after approval process.</things-i18n-msg>
    <things-i18n-msg auto msgid="text.invalid_input" msg="{{tInvalidInput}}" hidden>Invalid Input.</things-i18n-msg>
    <things-i18n-msg auto msgid="text.info_invalid" msg="{{tInfoInvalid}}" hidden>Typed information is not valid.</things-i18n-msg>
    <things-i18n-msg msgid="label.email_address" msg="{{lEmailAddress}}" auto hidden>Email Address</things-i18n-msg>

    <form is="iron-form" 
          id="form" 
          action=[[action]] 
          headers="[[headers]]" 
          content-type="application/json" 
          method="[[method]]" 
          last-response="{{lastResponse}}">
      
      <gold-email-input auto-validate required name="email" label="[[lEmailAddress]]">
      </gold-email-input>

      <paper-button class="btn-submit" raised on-click="_submitMyForm">
        <things-i18n-msg msgid="button.submit" auto>Submit</things-i18n-msg>
      </paper-button>

      <paper-button raised on-click="_resetMyForm">
        <things-i18n-msg msgid="button.reset" auto>Reset</things-i18n-msg>
      </paper-button>
    </form>
  </template>

  <script>
    Polymer({
      is: 'things-password-init',

      behaviors: [
        Things.FormBehavior,
        Things.SpinnerBehavior,
        Things.MsgBoxBehavior
      ],

      listeners: {
        'iron-form-response': '_successResponseHandler',
        'iron-form-error': '_errorResponseHandler'
      },

      _successResponseHandler: function(event) {
        this.stopSpinner();
        var me = this;

        this.openConfirmMsg({
          title: this.tPasswordInited,
          text: this.tCheckPasswordInMail
        }, function() {
          me.fire("things-password-init-success", me.serializeMyForm());
        });
      },

      _errorResponseHandler: function(event) {
        this.stopSpinner();
        var me = this;

        this.openConfirmMsg({
          type: 'warning',
          title: this.tInvalidInput,
          text: this.tInfoInvalid
        }, function() {
          me.fire("things-password-init-failure", event.detail);
        });
      },

      _submitMyForm: function(event) {
        this.$['form'].submit();
      },

      _resetMyForm: function(event) {
        this.resetMyForm();
      }
    });
  </script>
</dom-module>