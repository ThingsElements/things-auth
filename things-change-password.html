<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../gold-email-input/gold-email-input.html">

<link rel="import" href="../things-form/things-form-behavior.html">
<link rel="import" href="../things-msg-box-behavior/things-msg-box-behavior.html">
<link rel="import" href="../things-spinner/things-spinner-behavior.html">

<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->

<dom-module id="things-change-password">
  <template>
    <style>
      :host {
        @apply(--things-loose-padding)
      }
      paper-button {
        @apply(--things-button);
        float:right;
        margin-top:15px;
      }
      .btn-submit {
        @apply(--things-button-important)
      }
    </style>

    <form is="iron-form" 
      id="form" 
      action=[[action]]
      headers="[[headers]]"
      content-type="application/json"
      method="[[method]]"
      with-credentials=true
      last-response="{{lastResponse}}">
      
      <paper-input
        required name="name"
        label="User Name"
        value="{{userName}}"
        required
        auto-validate>
      </paper-input>
      <gold-email-input 
        auto-validate 
        required 
        name="email" 
        label="Email Address"
        value="[[userEmail]]"
        readonly>
      </gold-email-input>
      <paper-input 
        id="current-pw" 
        auto-validate 
        required 
        name="current_pass" 
        type="password"
        label="Current Password">
      </paper-input>
      <paper-input 
        id="new-pw" 
        required 
        name="new_pass" 
        type="password" 
        label="New Password">
      </paper-input>

      <paper-button class="btn-submit" raised on-click ="_submitMyForm">submit</paper-button>
      <paper-button raised on-click ="_resetMyForm">reset</paper-button>
    </form>
  </template>
  <script>
    Polymer({
      is: 'things-change-password',

      properties: {
        currentUserInfo: {
          type: Object,
          observer: '_currentUserInfoChanged'
        },

        userName: {
          type: String
        },

        userEmail: {
          type: String
        }
      },
      
      behaviors: [
        Things.FormBehavior,
        Things.SpinnerBehavior,
        Things.MsgBoxBehavior
      ],

      listeners: {
        'iron-form-response': '_successResponseHandler',
        'iron-form-error': '_errorResponseHandler'
      },
      
      _successResponseHandler: function(event) {
        this.stopSpinner();
        var me = this;
        this.openConfirmMsg({
          title: 'Password changed',
          text: 'Password changed succesfully.'
        }, function() {
          me.fire("things-change-password-success", me.serializeMyForm());
        });        
      },
      
      _errorResponseHandler: function(event) {
        this.stopSpinner();
        var me = this;

        this.openConfirmMsg({
          type: 'warning',
          title: 'Invalid Input',
          text: 'Typed information is not valid.'
        }, function() {
          me.fire("things-change-password-failure", event.detail);
        });
      },
      
      _submitMyForm: function(event) {
        this.$['form'].submit();
      },
      
      _resetMyForm: function(event) {
        this.resetMyForm();
      },

      _currentUserInfoChanged: function(userInfo) {
        this.userName = userInfo.name;
        this.userEmail = userInfo.email;
      }
    });
  </script>
</dom-module>